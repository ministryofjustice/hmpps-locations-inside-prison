{% from "govuk/components/table/macro.njk" import govukTable %}

{% from "../locationStatusTag.njk" import locationStatusTag %}

{% macro other(locations) %}
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
      {% set rows = [] %}
      {% for item in locations %}
        {% set inactiveCellsHtml %}
          {% if item.inactiveCells > 0 %}
            <a href="/inactive-cells/{{ item.prisonId }}/{{ item.id }}">{{ item.inactiveCells }}</a>
          {% else %}
            0
          {% endif %}
        {% endset %}

        {% set rows = (rows.push(
          [
            { html: "<a href='/view-and-update-locations/" + item.prisonId + "/" + item.id + "'>" + (item.localName or item.pathHierarchy) + "</a>" },
            { html: "<p class='govuk-tag__wrapper'>" + locationStatusTag(item) + "</p>" },
            { text: '-' if item.numberOfCellLocations == 0 else (item | includePending).workingCapacity },
            { text: '-' if item.numberOfCellLocations == 0 else (item | includePending).maxCapacity },
            { html: inactiveCellsHtml },
            { html: item.accommodationTypes | join('<br>') or '-' },
            { html: item.usedFor | join('<br>') or '-' }
          ]
        ), rows) %}
      {% endfor %}

      {{ govukTable({
        attributes: {
          "data-qa": "locations-table",
          "id": "locations-table"
        },
        firstCellIsHeader: true,
        head: [
          { text: "Location" },
          { text: "Status" },
          { text: "Working capacity" },
          { text: "Maximum capacity" },
          { text: "Inactive cells" },
          { text: "Accommodation type" },
          { text: "Used for" }
        ],
        rows: rows
      }) }}
    </div>
  </div>
{% endmacro %}
