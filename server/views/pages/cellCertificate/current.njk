{% extends "../../partials/layout.njk" %}

{% from "govuk/components/notification-banner/macro.njk" import govukNotificationBanner %}
{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "moj/components/sub-navigation/macro.njk" import mojSubNavigation %}

{% from "../../macros/cellCertificate.njk" import cellCertificate %}

{% block beforeContent %}
  {{ super() }}

  {% if banner.success %}
    {% set html %}
      <h3 class="govuk-notification-banner__heading">
        {{ banner.success.title }}
      </h3>
      <p class="govuk-body">
        {{ banner.success.content }}
      </p>
    {% endset %}

    <div class="govuk-width-container">
      <div class="govuk-grid-row govuk-!-margin-bottom-0">
        <div class="govuk-grid-column-two-thirds">
          {{ govukNotificationBanner({
            html: html,
            type: "success",
            classes: "govuk-!-margin-top-7 govuk-!-margin-bottom-0"
          }) }}
        </div>
      </div>
    </div>
  {% endif %}
{% endblock %}

{% block heading %}
  {{ super() }}

  {{ mojSubNavigation({
    label: "Sub navigation",
    items: [{
      text: "Current cell certificate",
      href: "/" + prisonId + "/cell-certificate/current",
      active: true
    }, {
      text: "Change requests (" + approvalRequests | length + ")",
      href: "/" + prisonId + "/cell-certificate/change-requests"
    }]
  }) }}
{% endblock %}

{% block content %}
  <div class="govuk-width-container">
    <h2 class="govuk-heading-l">Current cell certificate</h2>

    {% if certificate %}
      <p data-qa="last-approval">
        Last change approved by {{ userMap[certificate.approvedBy] }} on {{ certificate.approvedDate | formatDateWithTimeAndDay }}.
      </p>

      <p>
        <a href="/{{ prisonId }}/cell-certificate/history" class="govuk-link">View history of certificate changes</a>
      </p>

      {{ cellCertificate(certificate, accommodationTypeConstants, usedForConstants, specialistCellTypesObject) }}
    {% else %}
      <p>This prison does not have a cell certificate.</p>
    {% endif %}
  </div>
{% endblock %}
